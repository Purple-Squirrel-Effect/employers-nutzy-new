---
// ProductShowcaseSection.astro
// Mobile product showcase with iPhone mockup and GSAP animations

export interface Props {
  className?: string;
}

const { className = "" } = Astro.props;
---

<section
  class={`vsk-section-spacing bg-gradient-to-br from-purple-50 to-pink-50 ${className}`}
  data-product-showcase
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-16" data-showcase-header>
      <h2
        class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6 vsk-text-balance"
      >
        Hoe werkt het?
      </h2>
      <p class="text-xl text-gray-600 max-w-3xl mx-auto vsk-text-balance">
        Ontdek hoe Gen-Z talent en werkgevers verbinden via onze intu√Øtieve
        mobiele app. Van visuele vacatures tot instant matching - alles binnen
        handbereik.
      </p>
    </div>

    <!-- Main Showcase -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20 items-center">
      <!-- Content Side -->
      <div class="order-2 lg:order-1" data-showcase-content>
        <div class="space-y-8">
          <!-- Feature 1 -->
          <div class="flex items-start space-x-4" data-feature-item>
            <div
              class="flex-shrink-0 w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-purple-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"
                ></path>
              </svg>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                Visuele Vacatures
              </h3>
              <p class="text-gray-600">
                Swipe door visueel aantrekkelijke vacatures die perfect
                aansluiten bij jouw interesses en vaardigheden.
              </p>
            </div>
          </div>

          <!-- Feature 2 -->
          <div class="flex items-start space-x-4" data-feature-item>
            <div
              class="flex-shrink-0 w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-pink-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                ></path>
              </svg>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                Instant Matching
              </h3>
              <p class="text-gray-600">
                Krijg direct matches met werkgevers die op zoek zijn naar jouw
                unieke talenten en persoonlijkheid.
              </p>
            </div>
          </div>

          <!-- Feature 3 -->
          <div class="flex items-start space-x-4" data-feature-item>
            <div
              class="flex-shrink-0 w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-yellow-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"></path>
              </svg>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                Snelle Sollicitaties
              </h3>
              <p class="text-gray-600">
                Solliciteer in seconden met je visuele profiel. Geen lange
                formulieren, wel authentieke connecties.
              </p>
            </div>
          </div>

          <!-- CTA Button -->
          <div class="pt-6" data-showcase-cta>
            <button
              class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-lg vsk-transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-300 shadow-lg hover:shadow-xl"
              data-download-app-btn
              aria-label="Download de Nutzy app voor iOS en Android"
            >
              Download de App
            </button>
          </div>
        </div>
      </div>

      <!-- iPhone Mockup Side -->
      <div class="order-1 lg:order-2 flex justify-center" data-showcase-mockup>
        <div class="relative" data-iphone-container>
          <!-- iPhone Mockup -->
          <div class="relative z-10" data-iphone-device>
            <img
              src="/img/iphone-mockup.svg"
              alt="iPhone mockup showing Nutzy mobile app interface"
              class="w-80 h-auto drop-shadow-2xl"
              width="300"
              height="600"
              loading="lazy"
            />

            <!-- Screen Content Overlay -->
            <div class="absolute inset-0 z-20" data-screen-content>
              <!-- Home Screen -->
              <div
                class="absolute overflow-hidden iphone-screen-container"
                data-screen-home
                style="
                  top: 13.33%;
                  left: 8.33%;
                  width: 83.33%;
                  height: 73.33%;
                  border-radius: 35px;
                  clip-path: inset(0 round 35px);
                "
              >
                <img
                  src="/img/nutzy-mobile-home.svg"
                  alt="Nutzy app home screen showing job listings for Gen-Z talent"
                  class="w-full h-full object-cover"
                  width="250"
                  height="440"
                  loading="lazy"
                />
              </div>

              <!-- Profile Screen (initially hidden) -->
              <div
                class="absolute overflow-hidden iphone-screen-container opacity-0"
                data-screen-profile
                style="
                  top: 13.33%;
                  left: 8.33%;
                  width: 83.33%;
                  height: 73.33%;
                  border-radius: 35px;
                  clip-path: inset(0 round 35px);
                "
              >
                <img
                  src="/img/nutzy-mobile-profile.svg"
                  alt="Nutzy app profile screen showing user statistics and achievements"
                  class="w-full h-full object-cover"
                  width="250"
                  height="440"
                  loading="lazy"
                />
              </div>
            </div>
          </div>

          <!-- Floating Elements -->
          <div
            class="absolute -top-4 -right-4 w-16 h-16 bg-purple-200 rounded-full opacity-60"
            data-float-element-1
          >
          </div>
          <div
            class="absolute -bottom-8 -left-8 w-24 h-24 bg-pink-200 rounded-full opacity-40"
            data-float-element-2
          >
          </div>
          <div
            class="absolute top-1/2 -right-12 w-8 h-8 bg-yellow-300 rounded-full opacity-50"
            data-float-element-3
          >
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  function initProductShowcaseAnimations(): void {
    const showcaseSection = document.querySelector("[data-product-showcase]");
    if (!showcaseSection) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia(
      "(prefers-reduced-motion: reduce)"
    ).matches;
    if (prefersReducedMotion) return;

    // Animate section header
    const header = showcaseSection.querySelector("[data-showcase-header]");
    if (header) {
      gsap.fromTo(
        header,
        { opacity: 0, y: 50 },
        {
          opacity: 1,
          y: 0,
          duration: 0.8,
          ease: "power2.out",
          scrollTrigger: {
            trigger: header,
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse",
          },
        }
      );
    }

    // Animate content features
    const featureItems = showcaseSection.querySelectorAll(
      "[data-feature-item]"
    );
    featureItems.forEach((item, index) => {
      gsap.fromTo(
        item,
        { opacity: 0, x: -50 },
        {
          opacity: 1,
          x: 0,
          duration: 0.6,
          ease: "power2.out",
          delay: index * 0.1,
          scrollTrigger: {
            trigger: item,
            start: "top 85%",
            end: "bottom 15%",
            toggleActions: "play none none reverse",
          },
        }
      );
    });

    // Animate CTA button
    const ctaButton = showcaseSection.querySelector("[data-showcase-cta]");
    if (ctaButton) {
      gsap.fromTo(
        ctaButton,
        { opacity: 0, y: 30 },
        {
          opacity: 1,
          y: 0,
          duration: 0.6,
          ease: "power2.out",
          delay: 0.4,
          scrollTrigger: {
            trigger: ctaButton,
            start: "top 85%",
            end: "bottom 15%",
            toggleActions: "play none none reverse",
          },
        }
      );
    }

    // Animate iPhone mockup
    const mockup = showcaseSection.querySelector("[data-showcase-mockup]");
    if (mockup) {
      gsap.fromTo(
        mockup,
        { opacity: 0, x: 50, scale: 0.9 },
        {
          opacity: 1,
          x: 0,
          scale: 1,
          duration: 0.8,
          ease: "power2.out",
          delay: 0.2,
          scrollTrigger: {
            trigger: mockup,
            start: "top 80%",
            end: "bottom 20%",
            toggleActions: "play none none reverse",
          },
        }
      );
    }

    // Floating elements animation
    const floatElements = showcaseSection.querySelectorAll(
      "[data-float-element-1], [data-float-element-2], [data-float-element-3]"
    );
    floatElements.forEach((element, index) => {
      gsap.to(element, {
        y: "random(-20, 20)",
        x: "random(-10, 10)",
        rotation: "random(-15, 15)",
        duration: "random(3, 5)",
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true,
        delay: index * 0.5,
      });
    });

    // Screen transition animation
    const homeScreen = showcaseSection.querySelector("[data-screen-home]");
    const profileScreen = showcaseSection.querySelector(
      "[data-screen-profile]"
    );

    if (homeScreen && profileScreen) {
      // Create timeline for screen transitions
      const screenTimeline = gsap.timeline({
        repeat: -1,
        repeatDelay: 2,
        scrollTrigger: {
          trigger: mockup,
          start: "top 60%",
          end: "bottom 40%",
          toggleActions: "play pause resume pause",
        },
      });

      screenTimeline
        .to(
          homeScreen,
          { opacity: 0, duration: 0.5, ease: "power2.inOut" },
          "+=3"
        )
        .to(
          profileScreen,
          { opacity: 1, duration: 0.5, ease: "power2.inOut" },
          "-=0.25"
        )
        .to(
          profileScreen,
          { opacity: 0, duration: 0.5, ease: "power2.inOut" },
          "+=3"
        )
        .to(
          homeScreen,
          { opacity: 1, duration: 0.5, ease: "power2.inOut" },
          "-=0.25"
        );
    }

    // Add button functionality
    const downloadBtn = showcaseSection.querySelector(
      "[data-download-app-btn]"
    );
    if (downloadBtn) {
      downloadBtn.addEventListener("click", () => {
        // Placeholder for app store redirect logic
        console.log("Redirecting to app store...");
        // You can implement actual app store links here
        // window.open('https://apps.apple.com/app/nutzy', '_blank');
        // window.open('https://play.google.com/store/apps/details?id=com.nutzy', '_blank');
      });
    }
  }

  // Initialize when DOM is ready
  document.addEventListener("DOMContentLoaded", () => {
    initProductShowcaseAnimations();
  });
</script>

<style>
  /* Ensure proper z-index stacking */
  [data-iphone-container] {
    position: relative;
    z-index: 1;
  }

  [data-screen-content] {
    pointer-events: none;
  }

  /* Enhance drop shadow for better visual impact */
  [data-iphone-device] img {
    filter: drop-shadow(0 25px 50px rgba(0, 0, 0, 0.25));
  }

  /* iPhone Screen Container - Precise content containment */
  .iphone-screen-container {
    /* Ensure content is perfectly contained within iPhone screen boundaries */
    position: absolute;
    overflow: hidden;
    /* Use CSS mask for perfect screen shape matching */
    -webkit-mask: radial-gradient(
      ellipse at center,
      black 99%,
      transparent 100%
    );
    mask: radial-gradient(ellipse at center, black 99%, transparent 100%);
    /* Additional containment for content overflow */
    contain: layout style paint;
  }

  .iphone-screen-container img {
    /* Ensure images respect container boundaries */
    max-width: 100%;
    max-height: 100%;
    object-fit: cover;
    object-position: center;
    /* Prevent any potential overflow */
    transform: scale(0.999); /* Slight scale down to ensure no edge overflow */
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    [data-iphone-device] img {
      width: 280px;
    }

    [data-float-element-1],
    [data-float-element-2],
    [data-float-element-3] {
      display: none;
    }
  }
</style>
