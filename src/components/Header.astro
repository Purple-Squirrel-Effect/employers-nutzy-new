---
// Get current URL path for active navigation highlighting
const currentPath = Astro.url.pathname;

// Helper function to check if a navigation item is active
function isActive(href: string): boolean {
  // Handle home page special case
  if (href === "/#about" && currentPath === "/") {
    return true;
  }

  // Handle exact matches for other pages
  if (href.startsWith("/") && !href.includes("#")) {
    return currentPath.startsWith(href);
  }

  return false;
}

// Navigation items with their paths and labels
const navItems = [
  { href: "/#about", label: "Home" },
  { href: "/platform", label: "Platform" },
  { href: "/campain-strategy", label: "Content Creatie & Campagnes" },
  { href: "/blog", label: "Kennis delen" },
  { href: "/about", label: "Over ons" },
  { href: "/contact", label: "Contact" },
];
---

<header
  class="fixed px-4 md:px-8 lg:px-32 z-[60] backdrop-blur-md bg-primary-500/40 w-full text-white"
>
  <nav>
    <div class="container mx-auto flex justify-between items-center py-4">
      <!-- Logo -->
      <a
        href="/"
        class="flex items-center gap-3 group mr-4 z-50 relative"
        aria-label="Nutzy Home"
      >
        <svg
          class="h-10 md:h-12"
          viewBox="0 0 1123 467"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M118.254 5.79363C119.081 1.9619 114.034 -0.686125 110.585 1.75849C78.8248 24.2918 -9.2276 96.6549 1.06379 199.325C5.8968 247.518 30.5136 283.589 47.8802 304.021C50.1803 306.728 54.9756 306.045 56.2049 302.843C67.2777 273.972 77.6534 240.108 84.7563 201.797C88.5059 181.558 90.9193 162.364 92.3651 144.43C92.701 140.241 99.0138 139.033 101.295 142.719L115.001 164.857C116.063 166.572 118.311 167.414 120.445 166.892C131.904 164.096 147.253 161.477 165.452 161.391C185.485 161.299 202.222 164.308 214.338 167.409C216.511 167.964 218.817 167.109 219.878 165.347L233.397 142.897C235.584 139.266 241.754 140.273 242.334 144.354C247.001 177.151 253.733 212.722 263.347 250.483C272.378 285.954 282.764 318.672 293.634 348.45C294.883 351.875 300.098 352.428 302.237 349.364C316.551 328.844 342.31 283.503 331.821 228.504C321.218 172.89 279.223 137.128 266.332 126.962C205.181 78.7387 141.06 87.7452 121.461 44.6771C115.284 31.1049 115.773 17.2876 118.254 5.79363Z"
            fill="#581c87"></path>
          <path
            d="M105.498 358.251C104.59 356.889 96.1274 343.709 102.126 330.457C102.811 328.942 105.758 322.848 112.689 318.86C121.293 313.906 130.452 315.415 148.417 318.639C154.814 319.787 161.995 321.394 169.765 323.674C169.667 320.537 169.649 316.257 169.992 311.201C170.884 297.937 171.329 291.305 175.158 288.658C177.644 286.943 186.062 289.534 202.798 294.787C213.849 298.255 219.401 300.06 220.77 303.423C222.334 307.264 220.188 311.473 215.833 319.735C212.058 326.893 208.069 332.39 205.046 336.146C222.911 341.06 234.624 348.826 241.298 354.125C250.049 361.073 252.037 365.292 252.909 368.099C255.687 377.028 252.426 388.566 245.495 394.796C227.228 411.22 188.208 386.527 179.877 398.518C175.192 405.26 183.68 418.631 187.968 423.901C196.273 434.113 207.407 436.803 210.663 437.471C202.881 444.685 195.498 449.531 190.013 452.674C190.013 452.674 176.05 460.674 147.519 465.92C145.762 466.241 142.315 466.823 138.53 465.48C134.946 464.212 132.749 461.82 131.565 460.449C127.058 455.241 117.889 442.562 106.621 425.215C109.037 425.261 136.191 425.538 139.429 414.711C139.777 413.545 139.758 412.559 139.728 412.102C139.237 404.393 127.107 401.57 114.035 392.609C110.337 390.075 105.168 386.09 99.6543 380.135C101.601 372.84 103.549 365.545 105.498 358.251Z"
            fill="#25b4b3"></path>
          <path
            d="M128.118 231.397C128.118 238.689 124.73 244.599 120.552 244.599C116.374 244.599 112.988 238.689 112.988 231.397C112.988 224.105 116.374 218.194 120.552 218.194C124.73 218.194 128.118 224.105 128.118 231.397Z"
            fill="#581c87"></path>
          <path
            d="M221.973 230.521C221.973 237.813 218.587 243.723 214.407 243.723C210.231 243.723 206.844 237.813 206.844 230.521C206.844 223.229 210.231 217.318 214.407 217.318C218.587 217.318 221.973 223.229 221.973 230.521Z"
            fill="#581c87"></path>
          <path
            d="M187.176 254.551C187.176 248.573 178.254 243.724 167.252 243.724C156.247 243.724 147.326 248.573 147.326 254.551C147.326 260.166 155.188 264.781 165.257 265.323V273.763C165.257 274.976 166.274 275.967 167.52 275.967C168.763 275.967 169.783 274.976 169.783 273.763V265.283C179.589 264.605 187.176 260.065 187.176 254.551Z"
            fill="#581c87"></path>
          <path
            d="M545.699 242.829L546.107 155.343H578.365L578.161 239.846C577.957 263.708 588.371 274.842 606.949 274.842C625.529 274.842 635.533 263.708 635.533 239.846L635.737 155.343H668.201L667.997 242.829C667.997 283.788 643.088 305.263 607.153 305.263C571.017 305.263 545.699 283.788 545.699 242.829Z"
            fill="#581c87"></path>
          <path
            d="M731.291 183.776H689.232V155.344H805.812V183.776H763.753V302.281H731.291V183.776Z"
            fill="#581c87"></path>
          <path
            d="M927.705 159.718L869.719 273.849H927.295V302.281H821.129V297.905L879.316 183.777H819.494L826.641 155.344H927.705V159.718Z"
            fill="#581c87"></path>
          <path
            d="M1077.97 155.344L1022.03 247.204V302.281H989.772V248.398L933.627 155.344H972.623L1006.31 216.383L1040 155.344H1077.97Z"
            fill="#581c87"></path>
          <path
            d="M1082.53 279.312C1082.38 278.877 1081 274.689 1083.59 271.46C1083.89 271.094 1085.13 269.62 1087.32 268.995C1090.03 268.219 1092.43 269.253 1097.13 271.357C1098.8 272.103 1100.66 273.03 1102.63 274.182C1102.82 273.314 1103.12 272.139 1103.58 270.775C1104.77 267.199 1105.37 265.409 1106.61 264.945C1107.41 264.643 1109.53 265.924 1113.75 268.497C1116.53 270.197 1117.92 271.067 1118.06 272.08C1118.22 273.24 1117.32 274.25 1115.54 276.221C1113.99 277.929 1112.51 279.164 1111.41 279.99C1115.96 282.548 1118.62 285.47 1120.07 287.375C1121.47 289.216 1122.11 290.503 1122.25 291.995C1122.3 292.454 1122.66 296.151 1120 297.726C1118.2 298.789 1116.16 298.212 1115.68 298.066C1115.08 299.059 1114.37 300.101 1113.53 301.156C1110.95 304.42 1108.08 306.658 1105.72 308.156C1104.64 308.746 1103.4 309.348 1101.99 309.901C1100.86 310.351 1099.83 310.682 1098.97 310.926C1098.97 310.926 1094.57 312.174 1086.37 311.682C1085.86 311.653 1084.88 311.576 1083.94 310.954C1083.04 310.363 1082.61 309.559 1082.38 309.102C1081.52 307.368 1079.91 303.269 1078.06 297.75C1077.72 296.276 1077.39 294.142 1077.6 291.581C1077.85 288.673 1078.69 286.384 1079.37 284.917C1080.42 283.048 1081.48 281.181 1082.53 279.312Z"
            fill="#25b4b3"></path>
          <path
            d="M516.3 155.344V304.665H511.808L428.508 221.753V302.279H396.045V152.759H400.741L483.633 235.473V155.344H516.3Z"
            fill="#581c87"></path>
        </svg>
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden md:flex space-x-4">
        {
          navItems.map((item) => (
            <li>
              <a
                href={item.href}
                class={`relative transition-all duration-300 ease-in-out hover:text-secondary-200 pb-1 ${
                  isActive(item.href)
                    ? "text-secondary-200 font-semibold"
                    : "text-white"
                }`}
              >
                {item.label}
                <!-- Active indicator with smooth transition -->
                <span
                  class={`absolute bottom-0 left-0 h-0.5 bg-secondary-200 transition-all duration-300 ease-in-out ${
                    isActive(item.href)
                      ? "w-full opacity-100"
                      : "w-0 opacity-0"
                  }`}
                ></span>
              </a>
            </li>
          ))
        }
      </ul>

      <!-- Hamburger Menu Button -->
      <button
        id="hamburger-button"
        class="md:hidden z-50 relative w-8 h-8 flex flex-col justify-center items-center space-y-1.5 focus:outline-none focus:ring-2 focus:ring-secondary-200 focus:ring-opacity-50 rounded-md"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <span
          class="hamburger-line block w-6 h-0.5 bg-white transition-all duration-300 ease-in-out"
        ></span>
        <span
          class="hamburger-line block w-6 h-0.5 bg-white transition-all duration-300 ease-in-out"
        ></span>
        <span
          class="hamburger-line block w-6 h-0.5 bg-white transition-all duration-300 ease-in-out"
        ></span>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="md:hidden fixed inset-0 bg-primary-500/95 backdrop-blur-md transform translate-x-full transition-transform duration-300 ease-in-out z-40"
      aria-hidden="true"
    >
      <div class="flex flex-col justify-center items-center h-full space-y-8 px-8">
        {
          navItems.map((item) => (
            <a
              href={item.href}
              class={`mobile-nav-link text-2xl font-medium transition-all duration-300 ease-in-out hover:text-secondary-200 ${
                isActive(item.href)
                  ? "text-secondary-200 font-semibold"
                  : "text-white"
              }`}
            >
              {item.label}
            </a>
          ))
        }
      </div>
    </div>
  </nav>
</header>

<style>
  /* Hamburger menu animations */
  .hamburger-active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .hamburger-active .hamburger-line:nth-child(2) {
    opacity: 0;
  }

  .hamburger-active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  /* Mobile menu animations */
  .mobile-menu-open {
    transform: translateX(0);
  }

  /* Accessibility: Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .hamburger-line,
    #mobile-menu,
    .mobile-nav-link {
      transition: none !important;
    }
  }

  /* Ensure mobile menu is above other content */
  #mobile-menu {
    z-index: 40;
  }

  /* Hamburger button should be above mobile menu */
  #hamburger-button {
    z-index: 50;
  }
</style>

<script>
  interface MobileMenuState {
    isOpen: boolean;
    hamburgerButton: HTMLButtonElement | null;
    mobileMenu: HTMLElement | null;
    hamburgerLines: NodeListOf<HTMLElement>;
    mobileNavLinks: NodeListOf<HTMLElement>;
    prefersReducedMotion: boolean;
  }

  const mobileMenuState: MobileMenuState = {
    isOpen: false,
    hamburgerButton: null,
    mobileMenu: null,
    hamburgerLines: document.querySelectorAll('.hamburger-line'),
    mobileNavLinks: document.querySelectorAll('.mobile-nav-link'),
    prefersReducedMotion: window.matchMedia('(prefers-reduced-motion: reduce)').matches
  };

  function initializeMobileMenu(): void {
    // Get DOM elements
    mobileMenuState.hamburgerButton = document.getElementById('hamburger-button') as HTMLButtonElement;
    mobileMenuState.mobileMenu = document.getElementById('mobile-menu') as HTMLElement;
    mobileMenuState.hamburgerLines = document.querySelectorAll('.hamburger-line');
    mobileMenuState.mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

    if (!mobileMenuState.hamburgerButton || !mobileMenuState.mobileMenu) {
      console.warn('Mobile menu elements not found');
      return;
    }

    // Add click event listener to hamburger button
    mobileMenuState.hamburgerButton.addEventListener('click', toggleMobileMenu);

    // Add click event listeners to mobile nav links to close menu
    mobileMenuState.mobileNavLinks.forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });

    // Close menu when clicking outside
    mobileMenuState.mobileMenu.addEventListener('click', (e) => {
      if (e.target === mobileMenuState.mobileMenu) {
        closeMobileMenu();
      }
    });

    // Handle escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && mobileMenuState.isOpen) {
        closeMobileMenu();
        mobileMenuState.hamburgerButton?.focus();
      }
    });

    // Handle window resize - close menu if switching to desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 768 && mobileMenuState.isOpen) {
        closeMobileMenu();
      }
    });
  }

  function toggleMobileMenu(): void {
    if (mobileMenuState.isOpen) {
      closeMobileMenu();
    } else {
      openMobileMenu();
    }
  }

  function openMobileMenu(): void {
    if (!mobileMenuState.hamburgerButton || !mobileMenuState.mobileMenu) return;

    mobileMenuState.isOpen = true;

    // Update ARIA attributes
    mobileMenuState.hamburgerButton.setAttribute('aria-expanded', 'true');
    mobileMenuState.mobileMenu.setAttribute('aria-hidden', 'false');

    // Add classes for animations
    mobileMenuState.hamburgerButton.classList.add('hamburger-active');
    mobileMenuState.mobileMenu.classList.add('mobile-menu-open');

    // Prevent body scroll
    document.body.style.overflow = 'hidden';

    // Focus management - focus first nav link
    const firstNavLink = mobileMenuState.mobileNavLinks[0] as HTMLElement;
    if (firstNavLink) {
      setTimeout(() => firstNavLink.focus(), 300);
    }
  }

  function closeMobileMenu(): void {
    if (!mobileMenuState.hamburgerButton || !mobileMenuState.mobileMenu) return;

    mobileMenuState.isOpen = false;

    // Update ARIA attributes
    mobileMenuState.hamburgerButton.setAttribute('aria-expanded', 'false');
    mobileMenuState.mobileMenu.setAttribute('aria-hidden', 'true');

    // Remove classes for animations
    mobileMenuState.hamburgerButton.classList.remove('hamburger-active');
    mobileMenuState.mobileMenu.classList.remove('mobile-menu-open');

    // Restore body scroll
    document.body.style.overflow = '';
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', initializeMobileMenu);

  // Re-initialize on Astro page navigation
  document.addEventListener('astro:page-load', initializeMobileMenu);

  // Clean up on page unload
  document.addEventListener('astro:before-preparation', () => {
    // Restore body scroll in case menu was open
    document.body.style.overflow = '';
  });
</script>
